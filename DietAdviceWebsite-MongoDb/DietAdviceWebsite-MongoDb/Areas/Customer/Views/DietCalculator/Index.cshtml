@model DietAdviceWebsite_MongoDb.Areas.Customer.ViewModels.DietCalculatorViewModel

<div class="container main-content">
    <div class="page-header text-center">
        <h1>Tính toán chế độ ăn</h1>
        <p class="page-subtitle">Xác định nhu cầu calo và dinh dưỡng cá nhân hóa của bạn</p>
    </div>

    <div class="diet-calculator-wrapper">
        <!-- LEFT COLUMN: INPUT FORM -->
        <div class="calc-card form-section">
            <div class="card-header-simple">
                <h3>Thông tin cá nhân</h3>
            </div>
            <div class="card-body">
                <form id="dietForm" onsubmit="return false;">
                    <div class="form-group">
                        <label for="age">Tuổi (năm)</label>
                        <input type="number" id="age" class="form-control" placeholder="25" min="10" max="100" required>
                    </div>

                    <div class="form-group">
                        <label for="gender">Giới tính</label>
                        <select id="gender" class="form-control">
                            <option value="male">Nam</option>
                            <option value="female">Nữ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="height">Chiều cao (cm)</label>
                        <input type="number" id="height" class="form-control" placeholder="170" required>
                    </div>

                    <div class="form-group">
                        <label for="weight">Cân nặng (kg)</label>
                        <input type="number" id="weight" class="form-control" placeholder="70" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label for="activity">Mức độ hoạt động</label>
                        <select id="activity" class="form-control">
                            <option value="1.2">Ít hoạt động (ngồi nhiều)</option>
                            <option value="1.375">Nhẹ (tập 1-3 ngày/tuần)</option>
                            <option value="1.55">Vừa phải (tập 3-5 ngày/tuần)</option>
                            <option value="1.725">Năng động (tập 6-7 ngày/tuần)</option>
                            <option value="1.9">Rất năng động (VĐV)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="goal">Mục tiêu</label>
                        <select id="goal" class="form-control">
                            <option value="lose">Giảm cân</option>
                            <option value="maintain">Giữ cân</option>
                            <option value="gain">Tăng cân</option>
                        </select>
                    </div>

                    <button type="button" class="btn-calculate" onclick="calculateDiet()">
                        Tính toán
                    </button>
                </form>
            </div>
        </div>

        <!-- RIGHT COLUMN: RESULTS (Hidden initially) -->
        <div id="resultSection" class="result-section" style="display: none;">

            <!-- 1. Chỉ số chính (4 ô xanh) -->
            <h3 class="section-title">Kết quả tính toán</h3>
            <div class="result-stats-grid">
                <div class="stat-card green-card">
                    <span class="stat-label">BMI</span>
                    <span class="stat-value" id="resBMI">--</span>
                    <span class="stat-sub" id="resBMIStatus">Bình thường</span>
                </div>
                <div class="stat-card green-card">
                    <span class="stat-label">BMR (Calo cơ bản)</span>
                    <span class="stat-value" id="resBMR">--</span>
                    <span class="stat-sub">calo/ngày</span>
                </div>
                <div class="stat-card green-card">
                    <span class="stat-label">TDEE (Calo hàng ngày)</span>
                    <span class="stat-value" id="resTDEE">--</span>
                    <span class="stat-sub">calo/ngày</span>
                </div>
                <div class="stat-card green-card">
                    <span class="stat-label">Mục tiêu calo</span>
                    <span class="stat-value" id="targetCalories">--</span>
                    <span class="stat-sub" id="targetDesc">Giảm cân (500 kcal)</span>
                </div>
            </div>

            <!-- 2. Macro Nutrients -->
            <h3 class="section-title" style="margin-top: 30px;">Khuyến nghị Macro Nutrients</h3>
            <div class="macro-grid">
                <div class="macro-card">
                    <span class="macro-name">Protein</span>
                    <span class="macro-val text-blue" id="macroProtein">--g</span>
                    <span class="macro-percent">30%</span>
                </div>
                <div class="macro-card">
                    <span class="macro-name">Carbs</span>
                    <span class="macro-val text-green" id="macroCarbs">--g</span>
                    <span class="macro-percent">40%</span>
                </div>
                <div class="macro-card">
                    <span class="macro-name">Fats</span>
                    <span class="macro-val text-orange" id="macroFats">--g</span>
                    <span class="macro-percent">30%</span>
                </div>
            </div>

            <!-- 3. Thực đơn mẫu -->
            <h3 class="section-title" style="margin-top: 30px;">Thực đơn mẫu được tạo</h3>
            <div class="generated-menu-box">
                <!-- List món ăn sẽ được JS render vào đây -->
                <div id="menuPreviewList"></div>

                <!-- Tổng cộng -->
                <div class="menu-footer-summary">
                    <div class="footer-col">
                        <span class="f-label">Tổng cộng</span>
                        <span class="f-val" id="totalMenuCal">0 kcal</span>
                    </div>
                    <div class="footer-col-macros">
                        <span>P: <b id="totalMenuPro">0g</b></span>
                        <span>C: <b id="totalMenuCarb">0g</b></span>
                        <span>F: <b id="totalMenuFat">0g</b></span>
                    </div>
                </div>
            </div>

            <!-- Action Button -->
            <button class="btn-save-menu" onclick="saveToDailyMenu()">
                Lưu thực đơn này
            </button>
        </div>
    </div>
</div>

<!-- CSS Riêng -->
<link rel="stylesheet" href="~/css/diet-calculator.css">
<script>
    window.mealDB = @Html.Raw(
        System.Text.Json.JsonSerializer.Serialize(
            Model.Meals,
            new System.Text.Json.JsonSerializerOptions
            {
                PropertyNamingPolicy = System.Text.Json.JsonNamingPolicy.CamelCase
            }
        )
    );

    window.appData = {
        userId: '@User.FindFirst("UserId")?.Value',
        fullName: '@User.Identity.Name'
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/js/diet-calculator.js"></script>
